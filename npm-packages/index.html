<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>NPM Packages | BJ Anderson</title>

  <meta name="description" content="Practical advice for developing websites and web applications.">
  <meta name="author" content="BJ Anderson">

  <!-- How to generate favicons with GIMP - http://thenewcode.com/467/Creating-Multi-Resolution-Favicons-For-Web-Pages-With-GIMP -->
  <link rel="icon" href="/favicon.ico?v=0">
  <!-- <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff"> -->

  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Pacifico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Permanent+Marker"> -->

  <link rel="stylesheet" href="/vendor/prism/prism.css">

  <link rel="stylesheet" href="/styles.css">

  <script>
    function toggleActive() {
      try {
        document.querySelector('.navbar-burger').classList.toggle('is-active');
        document.querySelector('.navbar-menu').classList.toggle('is-active');
      } catch (err) {
        console.error('Error in toggleActive');
      }
    }
  </script>

</head>
<body>

  <nav class="navbar" role="navigation" aria-label="main navigation">

    <div class="navbar-brand">

      <a class="navbar-item" href="/">
        <div class="logo-image">
          <img src="/logo/emoji-64.png" alt="Logo">
        </div>
        <span class="title"> BJ Anderson </span>
      </a>

      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="headerNavBar" onclick="toggleActive()">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="headerNavBar" class="navbar-menu">

      <div class="navbar-start">
        <!-- <a class="navbar-item"> Blog </a> -->
      </div>

      <div class="navbar-end">
        <a class="navbar-item" href="/about.html"> About </a>
      </div>

    </div>
  </nav>

  <section class="section main">
    <div class="container">
      <div name="pwd-poll"></div>
      <div class="blog-post">

  <div class="blog-post-image">
    <img src="./blog-post-image.jpg" alt="Blog Post Image">
    <div class="attribution">
      <a target="_blank"
        href="https://unsplash.com/@vtrsnts?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge">
        VÃ­tor Santos | Unsplash.com
      </a>
    </div>
  </div>

  <div class="content">

    <h1>NPM Packages</h1>

    <p>
      If you want to build reusable code for the front-end then you need to learn how to build and deploy npm packages.
      You can either choose to use the public npm repository or your own private npm repo, but one thing is certain - if you're doing JavaScript development, then npm is going to be involved in the process somewhere.
    </p>

    <p>
      Like everything else we developers do, once you get the hang of it, it's actually a very easy process.
      And the more you do it, the opportunities you will find for automating things.
      But first we must walk...
    </p>

    <p>
      For our first npm package we will make a simple utils library.
      Before we get into the code, we need to decide where the npm package is going to live.
      Will it be available to the public?
      Is it proprietary and need to be protected?
      Are you building something that others can use and depend on?
      Are you just learning and experimenting?
      Are you building the next game-changing app and want to keep everything secret?
    </p>

    <p>
      I'll walk you through my process as an example, and that should give you enough information so that you can figure out how to do things your way.
    </p>

    <p>
      I ultimately intend for my utils library to be public, open-source software.
      However, I want to experiment a bit and climb the learning curve before I try pushing anything out to the community.
      So, I'll start by setting up a private npm repo on my computer, and then, when I'm sure my package is ready for prime-time, I'll move it to it's permanent home in the public npm repo.
    </p>

    <h2>Create and deploy local packages</h2>

    <h3>Verdaccio</h3>

    <p>
      First I'm going to install an application named Verdaccio (<a href="https://github.com/verdaccio/verdaccio">https://github.com/verdaccio/verdaccio</a>).
    </p>

    <p>
      You can use Verdaccio as a private repo that your whole team can use, or you can install it on your own machine and use it as a sandbox environment.
      Either way, there's really not much difference in how you use it compared to how you use other private or public npm repos.
    </p>

    <p class="step">
      Install Verdaccio:
      <pre><code class="language-bash">
        npm i -g verdaccio
      </code></pre>
    </p>

    <p class="step">
      Run Verdaccio:
      <pre><code class="language-bash">
        verdaccio
      </code></pre>
    </p>

    <p class="step">
      Add a user to your local verdaccio repo:
      <pre><code class="language-bash">
        npm adduser --registry http://localhost:4873
      </code></pre>

      When I'm installing Verdaccio on my local machine I use my username and set an easy password.
      If you use Verdaccio as a private repo for your company's proprietary code, then I would suggest setting up a dedicated account to administer it.
    </p>

    <p class="step">
      Publish a package to your Verdaccio repo:
      <pre><code class="language-bash">
        npm publish --registry http://localhost:4873
      </code></pre>

      If you want to make sure that your package does not get published to the public npm repo, I recommend adding the <code class="language-bash">package.json</code> setting to your <code class="language-bash">package.json</code> file, like so:
      <pre><code class="language-text">
        ##########
        # package.json
        ##########

        "publishConfig": { "registry": "http://localhost:4873/" }
      </code></pre>

      Note: If you set <code class="language-bash">"private": true</code> in your <code class="language-bash">package.json</code> file then your package won't be deployed anywhere, so make sure to use the <code class="language-bash">package.json</code> setting if you're creating a package that you want to publish to your private repo.
    </p>

    <p>
      Also worth noting here is the need to keep your package versions updated.
      If you try to publish your package with a version number that already exists in your npm repo, the publish command will fail.
      Thankfully, npm provides a cli command for updating your package version for you, but you can also edit the version number directly in your <code class="language-bash">package.json</code> file if you wish.
    </p>

    <p class="step">
      Install a package from your Verdaccio repo:
      <pre><code class="language-bash">
        npm install my-package --registry http://localhost:4873
      </code></pre>

      Or you can create a <code class="language-bash">.npmrc</code> file in your project and put the registry setting in it, then you won't have to use the registry flag when you install your package.
      <pre><code class="language-text">
        ##########
        # .npmrc
        ##########

        registry=http://localhost:4873
      </code></pre>
    </p>

    <p>
      Whenever you try to run npm commands in your project, make sure that verdaccio is running or you may get errors saying that your packages can't be found.
    </p>

    <p>
      Also, I've run into errors when I start a new project that depends on a shared library from my company's private npm repo where <code class="language-bash">npm install</code> fails with strange permissions errors.
      Unfortunately the error messages can sometimes be unhelpful or even misleading.
      If you get permissions errors when starting a new project and you are using a private npm repo, make sure you are logged in to the npm repo by running:
      <pre><code class="language-bash">
        npm login
      </code></pre>
    </p>

    <p>
      If you don't have login permissions, you may need to exclude your private dependencies from the initial install, and comment out the registry setting in your <code class="language-bash">.npmrc</code> file, install everything from the public npm repo first, and then try installing your private packages again after everything else succeeds.
    </p>

    <h2>Create and deploy public packages</h2>

    <p>
      All of these commands work exactly the same for the public npm repo, except that you don't have to set the registry setting anywhere.
      Commands such as <code class="language-bash">npm install</code> and <code class="language-bash">npm publish</code> all point to that public repo by default.
    </p>

    <h2>package.json scripts</h2>

    <p>
      All of this building and versioning and publishing can lead to a lot of command typing if we let it.
      Fortunately, npm gives us a way to automate most of this work with scripts.
      The following is a snippet from how I like to set up my <code class="language-bash">package.json</code> scripts to handle my package build and deployment process.

      <pre><code class="language-json">
        "scripts": [
          "prebuild": "rimraf dist/"
          "build": "node ./build.js",
          "prepush": "npm run build",
          "push": "npm publish --registry http://localhost:4873",
          "push:major": "npm run version:major && npm run push",
          "push:minor": "npm run version:minor && npm run push",
          "push:patch": "npm run version:patch && npm run push",
          "version:major": "npm version major --no-git-tag-version",
          "version:minor": "npm version minor --no-git-tag-version",
          "version:patch": "npm version patch --no-git-tag-version",
        ]
      </code></pre>

      Then, whenever I want to push a patch to my package I just run:
      <pre><code class="language-bash">
        npm run push:patch
      </code></pre>
      and my package is built, versioned, and published - all with one command.

    </p>

  </div>
</div>

    </div>
  </section>

  <footer class="footer">
    <div class="col left">

    </div>

    <div class="col middle">
      <div>
        <a href="/">bjanderson.github.io</a>
      </div>

      <div>
        &copy; 2019 BJ Anderson.
      </div>
    </div>

    <div class="col right">

    </div>
  </footer>

  <script src="/vendor/prism/prism.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112306194-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-112306194-1');
  </script>

</body>
</html>
